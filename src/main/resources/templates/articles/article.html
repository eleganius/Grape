<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{parts/common :: html_head}"></head>

<body>
	<header th:replace="~{parts/common :: page_header}"></header>
	<main class="album">
		<div class="container">
			<div class="row justify-content-center my-2">
				<div class="col-10 col-sm-8 col-md-4">
					<div class="card p-2">

						<div class="d-flex align-items-center">
							<!-- 投稿者 -->
							<a th:href="@{/grape/user/{id}(id=${article.userId})}" class="me-auto"><!--TODO article.userIdで遷移するには？-->
								<img th:src="@{/images/users/{avatar}(avatar=${article.user.avatar})}" width="32" height="32"
									class="rounded-circle">
								<small id="creator" class="d-inline-block align-bottom text-black ps-1">
									<strong>[[${article.user.name}]]</strong>
								</small>
							</a>
							<!-- 編集・削除 -->
							<a href="" class="align-baseline me-2">
								<i class="bi bi-pen me-1"></i>
							</a>
							<a href="" id="deleteArticle" class="text-danger align-baseline">
								<i class="bi bi-trash3 me-1"></i>
							</a>
						</div>
						<!-- 投稿画像 -->
						<img th:src="@{/images/wines/{image}(image=${article.image})}" class="rounded mt-2">

						<div class="d-flex justify-content-between pt-2">
							<span class="d-flex">
								<!-- いいね -->
								<small class="pe-1">
									<i class="bi bi-suit-heart-fill iine" data-articleId=""></i>
									<span id="likeCount">[[${article.like.likeCount}]]</span>
								</small>
								<!-- コメント -->
								<small class="px-1">
									<i class="bi bi-chat-dots text-muted"></i>
									<span id="CommentCount">[[${article.comment.commentCount}]]</span>
								</small>
								<!-- offcanvas -->
								<small>
									<button class="btn btn-sm btn-link px-1 pb-0" type="button" data-bs-toggle="offcanvas"
										data-bs-target="#offcanvasRight" aria-controls="offcanvasRight">
										<i class="bi bi-journal-text"></i>
									</button>
									<!-- import parts.offcanvas -->
								</small>
							</span>
							<!-- 投稿日時 -->
							<small class="text-muted created">
								[[${#dates.format(article.created, 'yy-MM-dd HH:mm')}]]
							</small>
						</div>

						<!-- 投稿内容 -->
						<div class="border-top border-light-subtle p-1">
							[[${article.caption}]]
						</div>

						<div class="d-flex align-items-center border-top border-light-subtle pt-2">
							<small class="d-block">
								<!-- コメントユーザー -->
								<a th:href="@{/grape/user/{id}(id=${article.comment.user.id})}"
									class="d-inline-flex text-black align-middle">
									<img th:src="@{/images/users/{avatar}(avatar=${article.comment.user.avatar})}" width="24" height="24"
										class="rounded-circle">
									<strong class="px-1">
										[[${article.comment.user.name}]]
									</strong>
								</a>
								<!-- コメント内容 -->
								[[${article.comment.body}]]
							</small>
							<!-- コメント削除 -->
							<a href="" class="d-block ms-auto">
								<i id="deleteComment" class="bi bi-trash3 text-muted"></i>
							</a>
						</div>

						<!-- コメント日時 -->
						<small class="d-block text-end text-muted" style="font-size: 0.5rem;">
							[[${#dates.format(article.comment.created, 'yy-MM-dd HH:mm')}]]
						</small>

						<!-- コメントフォーム -->
						<form action="" method="post">
							<!--
							<input type="hidden" th:field="*{userId}" th:value="ログインユーザーID">
							<input type="hidden" th:field="*{articleId}" th:value="表示投稿ID">
							-->
							<div class="d-flex align-items-center border-top border-light-subtle pt-2">
								<textarea class="form-control border-0" rows="1" placeholder="コメントを追加"></textarea>
								<button class="d-block btn btn-sm btn-link pe-0" type="submit">
									<i class="bi bi-send"></i>
								</button>
							</div>
						</form>

					</div>
				</div>
			</div>
		</div>
	</main>
	<div th:replace="~{parts/common :: block_script}"></div>
	<script th:src="@{/js/iine.js}"></script>
	<script>
		$(document).ready(function () {

			//記事削除アラート
			const deleteArticle = document.getElementById('deleteArticle');
			deleteArticle.addEventListener('click', e => {
				const result = confirm("本当に削除しますか？");
				if (!result) {
					e.preventDefault();
				}
			});

			//コメント削除アラート
			const deleteComment = document.getElementById('deleteComment');
			deleteComment.addEventListener('click', e => {
				const result = confirm("本当に削除しますか？");
				if (!result) {
					e.preventDefault();
				}
			});

		});

	</script>
</body>

</html>