<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{parts/common :: html_head}"></head>

<body>
	<header th:replace="~{parts/common :: page_header}"></header>
	<div class="hero">
		<img th:src="@{/images/covers/cover1.jpg}" class="current">
		<img th:src="@{/images/covers/cover2.jpg}">
		<img th:src="@{/images/covers/cover3.jpg}">
		<img th:src="@{/images/covers/cover4.jpg}">
		<img th:src="@{/images/covers/cover5.jpg}">
	</div>
	<main class="album bg-light">
		<div class="container">
			<div class="row row-cols-sm-2 row-cols-lg-3">
				<div class="col-sm-6 col-lg-4 my-2 animate" th:each="article, status : ${articleList}">
					<div class="card shadow-sm">

						<!-- 投稿画像 -->
						<a th:href="@{/grape/article/{id}(id=${status.index})}"><!-- TODO article.idでリンク遷移するには？ -->
							<img th:src="@{/images/wines/{image}(image=${article.image})}"
								class="bd-placeholder-img card-img-top img-fluid img-thumbnail">
						</a>

						<div class="card-body py-2">

							<!-- 投稿者 -->
							<a th:href="@{/grape/user/{id}(id=${status.index})}">
								<img th:src="@{/images/users/{avatar}(avatar=${article.user.avatar})}" width="32" height="32"
									class="rounded-circle">
								<small class="d-inline-block align-bottom text-black ps-1">
									<strong>[[${article.user.name}]]</strong>
								</small>
							</a>

							<!-- 投稿内容 -->
							<p class="card-text text-truncate my-2">
								[[${article.bodyText}]]
							</p>

							<div class="d-flex justify-content-between">
								<span class="d-flex">

									<!-- いいね -->
									<small class="pe-1">
										<i class="bi bi-suit-heart-fill iine" data-articleId=""></i>
										<span id="likeCount">100</span>
									</small>

									<!-- コメント -->
									<small id="dots" class="px-1">
										<i class="bi bi-chat-dots text-muted"></i>
										<span id="CommentCount">100</span>
									</small>

								</span>

								<!-- 投稿日時 -->
								<small class="text-muted created">
									[[${#dates.format(article.created, 'yy-MM-dd HH:mm')}]]
								</small>

							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</main>
	<div th:replace="~{parts/common :: block_script}"></div>
	<script>
		$(document).ready(function () {

			//heroスライドショー
			function play() {
				setTimeout(() => {
					images[currentIndex].classList.remove('current');
					currentIndex++;
					if (currentIndex > images.length - 1) {
						currentIndex = 0;
					}
					images[currentIndex].classList.add('current');
					play();
				}, 2000);
			}
			const images = document.querySelectorAll('.hero img');
			let currentIndex = 1;
			play();

			//投稿ふわっと表示（Intersection Observer API）
			function callback(entries, obs) {
				entries.forEach(entry => {
					if (!entry.isIntersecting) {
						return;
					}
					entry.target.classList.add('appear');
					obs.unobserve(entry.target);
				});
			}
			const options = {
				threshold: 0.2,
			};
			const observer = new IntersectionObserver(callback, options);
			const targets = document.querySelectorAll('.animate');
			targets.forEach(target => {
				observer.observe(target);
			});

			//いいねトグル
			$('.iine').click(function () {
				$(this).toggleClass('bi-suit-heart-fill');
				$(this).toggleClass('bi-suit-heart');
			});

		});

	</script>
</body>

</html>