<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{parts/common :: html_head}"></head>

<body>
	<header th:replace="~{parts/common :: page_header}"></header>
	<main class="bg-light">
		<div class="container">

			<div class="d-flex justify-content-end align-items-center my-3">
				<a href="" class="align-baseline me-2">
					<i class="bi bi-person-up me-1"></i>
					更新
				</a>
				<a href="" id="deleteUser" class="text-danger align-baseline">
					<i class="bi bi-person-down me-1"></i>
					退会
				</a>
			</div>

			<div class="row justify-content-evenly align-items-center">
				<div class="col-10 justify-content-evenly align-items-center">
					<div class="d-flex justify-content-evenly align-items-center mb-3">

						<div class="d-grid gap-3 px-2">
							<!-- ユーザーアイコン -->
							<img th:src="@{/images/users/{avatar}(avatar=${user.avatar})}" width="125px" height="125px"
								style="border-radius: 50%; object-fit: cover;">

							<!-- フォローボタン -->
							<form action="@{grape/addFollow}" method="post" class="mx-auto">
								<input type="hidden" name="followerId" value="">
								<input type="hidden" name="followeeId" value="">
								<button class="btn btn-sm btn-primary" type="submit">フォローする</button>
							</form>
							<!--
							<form action="" method="post" class="mx-auto">
								<input type="hidden" name="followerId" value="">
								<input type="hidden" name="followeeId" value="">
								<button class="btn btn-sm btn-info" type="submit">フォロー中</button>
							</form>
							-->
						</div>

						<div class="d-grid gap-2 px-2">
							<strong>
								[[${user.name}]]
							</strong>
							<!-- Button trigger modal -->
							<div>
								フォロワー
								<button id="follower" type="button" class="btn btn-sm btn-link text-black fw-bold px-1"
									data-bs-toggle="modal" data-bs-target="#exampleModal">
									<span style="bottom: 2px; position: relative;">
										100
									</span>
								</button>
								フォロー中
								<button id="following" type="button" class="btn btn-sm btn-link text-black fw-bold px-1"
									data-bs-toggle="modal" data-bs-target="#exampleModal">
									<span style="bottom: 2px; position: relative;">
										100
									</span>
								</button>
							</div>
							<!-- import parts.modal -->
							<div>
								[[${user.introduction}]]
							</div>
						</div>

					</div>
				</div>
			</div>
			<hr class="m-0">

			<div class="d-flex justify-content-evenly my-2">
				<a href="" class="text-muted">
					<i class="bi bi-grid-3x3-gap-fill"></i>
					<small>[[${user.name}]]さんの投稿</small>
				</a>
				<a href="" class="text-muted">
					<i class="bi bi-grid-3x3-gap"></i>
					<small>非公開・下書き投稿</small>
				</a>
				<a href="" class="text-muted">
					<i class="bi bi-bookmark-heart"></i>
					<small>いいねした投稿</small>
				</a>
			</div>

			<div class="row row-cols-sm-2 row-cols-lg-3">
				<div class="col-sm-6 col-lg-4 my-2 animate" th:each="article, status : ${articleList}">
					<div class="card shadow-sm">

						<!-- 投稿画像 -->
						<a th:href="@{/grape/article/{id}(id=${status.index})}">
							<img th:src="@{/images/wines/{image}(image=${article.image})}"
								class="bd-placeholder-img card-img-top img-fluid img-thumbnail">
						</a>

						<div class="card-body py-2">

							<!-- 投稿者 -->
							<a th:href="@{/grape/user/{id}(id=${status.index})}">
								<img th:src="@{/images/users/{avatar}(avatar=${article.user.avatar})}" width="32" height="32"
									class="rounded-circle">
								<small class="d-inline-block align-bottom text-black ps-1">
									<strong>[[${article.user.name}]]</strong>
								</small>
							</a>

							<!-- 投稿内容 -->
							<p class="card-text text-truncate my-2">
								[[${article.bodyText}]]
							</p>

							<div class="d-flex justify-content-between">
								<span class="d-flex">

									<!-- いいね -->
									<small class="pe-1">
										<i class="bi bi-suit-heart-fill iine" data-articleId=""></i>
										<span id="likeCount">100</span>
									</small>

									<!-- コメント -->
									<small id="dots" class="px-1">
										<i class="bi bi-chat-dots text-muted"></i>
										<span id="CommentCount">100</span>
									</small>

								</span>

								<!-- 投稿日時 -->
								<small class="text-muted created">
									[[${#dates.format(article.created, 'yy-MM-dd HH:mm')}]]
								</small>

							</div>
						</div>
					</div>
				</div>
			</div>

		</div>
	</main>
	<div th:replace="~{parts/common :: block_script}"></div>
	<script>
		$(document).ready(function () {

			//投稿ふわっと表示（Intersection Observer API）
			function callback(entries, obs) {
				entries.forEach(entry => {
					if (!entry.isIntersecting) {
						return;
					}
					entry.target.classList.add('appear');
					obs.unobserve(entry.target);
				});
			}
			const options = {
				threshold: 0.2,
			};
			const observer = new IntersectionObserver(callback, options);
			const targets = document.querySelectorAll('.animate');
			targets.forEach(target => {
				observer.observe(target);
			});

			//いいねトグル
			$('.iine').click(function () {
				$(this).toggleClass('bi-suit-heart-fill');
				$(this).toggleClass('bi-suit-heart');
			});

		});

	</script>
</body>

</html>